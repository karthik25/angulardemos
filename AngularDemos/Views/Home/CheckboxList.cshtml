@{
    ViewBag.Title = "CheckboxList";
}

<style type="text/css">
    ul.dropdown-menu-form {
        padding: 0 0 0 30px;
        max-height: 200px;
        overflow-y: scroll;
    }
</style>

<h2>CheckboxList</h2>

<div class="container">
    <div ng-app="HelperModules">
        <div ng-controller="ListController">
            <div class="dropdown">
                <a class="dropdown-toggle btn btn-default" data-toggle="dropdown" href="#">Clients <b class="caret"></b></a>
                <ul id="clientList" class="dropdown-menu dropdown-menu-form" role="menu">
                    <li ng-repeat="client in clients">
                        <label class="checkbox" data-id="{{ client.Id }}">
                            <input type="checkbox" />
                            <span>{{ client.Name }}</span>
                        </label>
                    </li>                    
                </ul>
            </div>
            <br/>
            <div class="dropdown">
                <a class="dropdown-toggle btn btn-default" data-toggle="dropdown" href="#">Packages <b class="caret"></b></a>
                <ul id="packageList" class="dropdown-menu dropdown-menu-form" role="menu">
                    <li ng-repeat="package in packages">
                        <label class="checkbox" data-id="{{ package.Id }}">
                            <input type="checkbox" />
                            <span>{{ package.Name }}</span>
                        </label>
                    </li>                    
                </ul>
            </div>

            <br/>
            <input type="button" name="btnGo" value="Go!" id="btnGo" class="btn btn-success" />
            <br/><br/>
            <textarea class="form-control" id="results"></textarea>
        </div>
    </div>
</div>

<script src="~/Scripts/angular.js"></script>
<script src="~/Scripts/jquery-2.1.1.js"></script>
<script>
    var module = angular.module("HelperModules", []);

    module.controller("ListController", function ($scope, $http) {
        $scope.clients = [];
        $scope.packages = [];

        $http.get('/api/basic/clients').success(function (data) {
            $scope.clients = data;
        });
        
        $http.get('/api/basic/packages').success(function (data) {
            $scope.packages = data;
        });

        $scope.getValues = function() {
            alert('clicked');
        };
    });
</script>

@section scripts
{
    <script>
        $(function () {
            $('.dropdown-menu').on('click', function (e) {
                if ($(this).hasClass('dropdown-menu-form')) {
                    e.stopPropagation();
                }
            });

            $('#btnGo').on('click', function () {
                var chosenIds = [];
                var chosenPackages = [];
                var checkboxes = $('#clientList').find('input:checkbox:checked');
                var pkgCheckboxes = $('#packageList').find('input:checkbox:checked');
                $.each(checkboxes, function () {
                    var item = this;
                    var id = $(item).parent().data('id');
                    chosenIds.push(id);                        
                });
                $.each(pkgCheckboxes, function () {
                    var item = this;
                    var id = $(item).parent().data('id');
                    chosenPackages.push(id);
                });
                $('#results').html(chosenIds.join(', ') + " : " + chosenPackages.join(', '));
            });
        })
</script>
}
